# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is a Timeline card game built with React and TypeScript. Players place historical event cards in chronological order on a timeline. Correct placements keep cards; incorrect placements discard the card and draw a new one. First player to empty their hand wins.

## Commands

All commands run from `timeline-game/` directory:

```bash
npm start          # Start dev server at localhost:3000
npm run build      # Production build
npm test           # Run tests in watch mode
```

Note: `npm start` and `npm run build` auto-generate `manifest.json` via a prestart/prebuild script.

## Architecture

### Core Data Flow

- **App.tsx** - Root component managing game phases (setup → playing → gameOver)
- **useGameState.ts** - Central hook managing all game state, card placement logic, and turn progression
- **gameLogic.ts** - Pure functions for game rules (placement validation, deck operations, win conditions)

### Component Hierarchy

```
App.tsx
├── GameSetup.tsx          # Player count, names, game config
└── GameBoard.tsx          # DndContext wrapper, game over display
    ├── PlayerInfo.tsx     # Current player, scores, turn info
    ├── Timeline/
    │   ├── Timeline.tsx       # Horizontal/vertical scrolling timeline
    │   ├── TimelineCard.tsx   # Placed event cards (show year)
    │   └── InsertionPoint.tsx # Drop zones between cards
    ├── Hand/
    │   ├── Hand.tsx           # Current player's cards
    │   ├── HandCard.tsx       # Draggable cards (hide year)
    │   └── SelectableHandCard.tsx # Tap mode for mobile
    ├── Card.tsx            # Base card rendering
    └── EventDescriptionModal.tsx # Card detail popup on click/long-press
```

### Event System

Historical events are loaded from JSON files in `public/events/`:
- **manifest.json** - Auto-generated by `scripts/generate-manifest.js` listing categories
- **eventLoader.ts** - Fetches and deduplicates events at startup
- Events have: `name` (ID), `friendly_name`, `year`, `category`, `description`, `difficulty`, optional `image_url`

Categories: `conflict`, `disasters`, `exploration`, `cultural`, `infrastructure`, `diplomatic`

### Drag and Drop

Uses @dnd-kit for card interactions:
- **GameBoard.tsx** - DndContext wrapper handling drag events and drop zones
- **Timeline/Timeline.tsx** - Sortable timeline with edge drop zones for inserting at ends
- **Hand/Hand.tsx** - Current player's draggable cards

Mobile devices use "tap mode" via `useMobileDetection.ts` - tap to select card, tap insertion point to place. Timeline displays vertically on mobile in tap mode.

### Styling

- Tailwind CSS with custom theme in `tailwind.config.js`
- Hand-drawn aesthetic using Caveat and Patrick Hand fonts
- Custom colors: `cream`, `paper`, `sketch` for UI; category-specific colors for cards
- Custom animations: `card-hover`, `shake`, `pulse-glow`, `flip`, `screen-shake`

## Key Types

```typescript
interface HistoricalEvent {
  name: string;           // Unique ID
  friendly_name: string;  // Display name
  year: number;           // Negative for BCE
  category: Category;
  difficulty: Difficulty;
}

interface GameState {
  phase: 'setup' | 'playing' | 'gameOver';
  timeline: HistoricalEvent[];
  deck: HistoricalEvent[];
  players: Player[];
  currentPlayerIndex: number;
}
```

## Adding Events

1. Add/edit JSON files directly in `public/events/` (one file per category)
2. Manifest is auto-generated on `npm start` or `npm run build`
3. Events are deduplicated by `name` field at runtime
